#!/usr/bin/env php
<?php
/*
 * This file is part of XRL, a simple XML-RPC Library for PHP.
 *
 * Copyright (c) 2012, XRL Team. All rights reserved.
 * XRL is licensed under the 3-clause BSD License.
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */

if (version_compare(phpversion(), '5.3.4', '<')) {
    echo "XRL requires PHP 5.3.4 or newer." . PHP_EOL;
    exit -1;
}

$extensions = array(
    'phar',
    'spl',
    'xmlreader',
    'xmlwriter',
    'libxml',
    'simplexml',
    'gmp',
    'pcre',
);

foreach ($extensions as $ext) {
    if (!extension_loaded($ext)) {
        echo "Extension $ext is required" . PHP_EOL;
        exit -1;
    }
}

@include_once(
    dirname(__DIR__) .
    DIRECTORY_SEPARATOR . 'vendor' .
    DIRECTORY_SEPARATOR . 'autoload.php'
);

if (!strncasecmp(substr(__FILE__, -5), '.phar', 5)) {
    try {
        Phar::mapPhar();
    } catch (Exception $e) {
        echo "Cannot process XRL phar:" . PHP_EOL;
        echo $e->getMessage() . PHP_EOL;
        exit -1;
    }
    $base = 'phar://' . __FILE__;
} else {
    $base = dirname(__DIR__);
}

if (!class_exists('\\fpoirotte\\XRL\\Autoload')) {
    require_once(
        $base .
        DIRECTORY_SEPARATOR . 'src' .
        DIRECTORY_SEPARATOR . 'Autoload.php'
    );
    \fpoirotte\XRL\Autoload::register();
}

$cli = new \fpoirotte\XRL\CLI();
die($cli->run($_SERVER['argv']));

__HALT_COMPILER();
